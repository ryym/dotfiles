#!/usr/bin/env sh

# A script called from Vim's fzf utility. See: ./dotfiles/vim/autoload/my/plug/fzf.vim

main() {
    cmd="$1"
    shift
    case "$cmd" in
        buffers) buffers "$@" ;;
        buffers_and_files) buffers_and_files "$@" ;;
        fd_formatted) fd_formatted "$@" ;;
        *)
            echo 'specify valid command'
            exit 1
    esac
}

# Format buffers passed as arguments.
buffers() {
    for filepath in "$@"; do
        printf "\033[38;5;245m:\033[0m \033[33m%s\033[0m \033[38;5;245m%s/\033[38;5;240m%s\033[0m\n" \
            "$(basename "$filepath")" "$(dirname "$filepath")" "$(basename "$filepath")"
        excludes+=("-E" "$filepath")
    done
}

# - list all files as well as currently open buffers in Vim
# - list buffers first and list other files excluding buffers
# Buffers are passed as arguments.
buffers_and_files() {
    excludes=()
    for filepath in "$@"; do
        printf "\033[38;5;245m:\033[0m \033[33m%s\033[0m \033[38;5;245m%s/\033[38;5;240m%s\033[0m\n" \
            "$(basename "$filepath")" "$(dirname "$filepath")" "$(basename "$filepath")"
        excludes+=("-E" "$filepath")
    done
    fd --hidden -tf -tl -E .git ${excludes[@]} --format "[38;5;245m=[0m {/} [38;5;245m{//}/[38;5;240m{/}[0m"
}

fd_formatted() {
    fd --hidden -tf -tl -E .git ${excludes[@]} --format "[38;5;245m=[0m {/} [38;5;245m{//}/[38;5;240m{/}[0m" "$@"
}

main "$@"
