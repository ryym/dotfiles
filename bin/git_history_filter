#!/bin/bash

# A script to filter and operate Git logs interactively.

# Key bindings of fzf:
# Ctrl-g: Copy the commit hash.
# Ctrl-r: Start the interactive rebase from the *previous* commit of the selected one.

git re -100 --color=always $@ \
    | nl -w 3 -s ' ' \
    | fzf --ansi --no-sort --tmux 80% \
        --preview 'echo {} | awk "{print \$2}" | xargs git show | delta' \
        --bind "ctrl-g:become(echo {} | awk '{print \$2}' | tr -d '\n' | pbcopy)" \
        --bind "ctrl-r:become(echo {} | awk '{print \$2 \"^\"}' | xargs git rebase -i)"
